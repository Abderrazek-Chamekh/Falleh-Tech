<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<AnchorPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="tn.esprit.fx.FrontViewController"
            stylesheets="@../styles/sidebar_front.css">

    <children>
        <BorderPane AnchorPane.topAnchor="0"
                    AnchorPane.bottomAnchor="0"
                    AnchorPane.leftAnchor="0"
                    AnchorPane.rightAnchor="0">

            <!-- âœ… NAVBAR EN HAUT -->
            <top>
                <HBox spacing="10" alignment="CENTER" styleClass="navbar" prefHeight="60">
                    <padding>
                        <Insets top="5" bottom="5" left="15" right="15"/>
                    </padding>

                    <!-- ðŸ‘‡ Le titre de la page active -->
                    <Label fx:id="activePageLabel" styleClass="navbar-title"/>

                    <Region fx:id="navbarSpacer" HBox.hgrow="ALWAYS"/>

                    <!-- ðŸ‘‡ Role Label -->
                    <Label fx:id="roleLabel" style="-fx-font-size: 12px; -fx-text-fill: #666;" />
                    <!-- ðŸ”” Notification Button with Badge -->

                    <StackPane fx:id="notificationWrapper" alignment="TOP_RIGHT" style="-fx-padding: 5;">
                        <Button fx:id="notificationBell" onAction="#toggleNotificationsPopup" styleClass="notification-bell-button">
                            <graphic>
                                <HBox spacing="5" alignment="CENTER_LEFT">
                                    <Label text="ðŸ””" style="-fx-font-size: 20px;"/>
                                    <Label text="Notifications" style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #333;" />
                                </HBox>
                            </graphic>
                        </Button>

                        <Label fx:id="notificationBadge"
                               text="0"
                               visible="false"
                               style="-fx-background-color: red;
                  -fx-text-fill: white;
                  -fx-font-size: 11px;
                  -fx-padding: 2 6 2 6;
                  -fx-background-radius: 50;
                  -fx-translate-x: 12;
                  -fx-translate-y: -8;
                  -fx-font-weight: bold;"/>
                    </StackPane>



                    <!-- âœ… Menu Profil dÃ©roulant -->
                    <MenuButton fx:id="profileMenu" popupSide="BOTTOM" styleClass="profile-menu-button">
                        <graphic>
                            <HBox spacing="6" alignment="CENTER">
                                <ImageView fx:id="menuAvatar" fitWidth="22" fitHeight="22" preserveRatio="true"/>
                                <Label fx:id="profileNameLabel" text="Abbassi Fares" styleClass="profile-name-label"/>
                            </HBox>
                        </graphic>
                        <items>

                            <MenuItem text="ï¸Carte" styleClass="profile-item" onAction="#goToMap"/>
                            <MenuItem text="SMS" styleClass="profile-item" onAction="#goToSms"/>
                            <MenuItem text="ï¸HeatMap" styleClass="profile-item" onAction="#goToHeatmap"/>
                            <MenuItem text="ðŸ‘¤ Profile" styleClass="profile-item" onAction="#openProfile"/>
                            <MenuItem text="âœ”ï¸ VÃ©rifier le compte" styleClass="profile-item" onAction="#verifyAccount"/>
                            <MenuItem text="ðŸšª DÃ©connexion" styleClass="logout-item" onAction="#logout"/>
                        </items>
                    </MenuButton>
                </HBox>
            </top>

            <!-- âœ… SIDEBAR Ã€ GAUCHE -->
            <left>
                <VBox spacing="20" alignment="TOP_LEFT" styleClass="sidebar">
                    <padding>
                        <Insets top="20" bottom="20" left="20" right="10"/>
                    </padding>

                    <!-- ðŸ”° Logo -->
                    <VBox alignment="CENTER" spacing="8" styleClass="logo-section">
                        <ImageView fx:id="logoImage" fitWidth="140" preserveRatio="true"/>
                    </VBox>

                    <!-- ðŸ§­ Navigation -->
                    <Button fx:id="accueilButton" text="Page d'accueil" onAction="#goToAccueil" styleClass="sidebar-button"/>
                    <Button fx:id="produitsButton" text="Produits" onAction="#goToProduits" styleClass="sidebar-button"/>

                    <VBox fx:id="categorieTreeContainer" visible="false" managed="false" spacing="5" styleClass="tree-container">
                        <Label text="CatÃ©gories disponibles" styleClass="tree-title"/>
                        <TreeView fx:id="categorieTree"/>
                    </VBox>

                    <Button fx:id="panierButton" text="Panier" onAction="#goToPanier" styleClass="sidebar-button"/>
                    <Button fx:id="commandesButton" text="Commandes" onAction="#goToCommandes" styleClass="sidebar-button"/>
                    <Button fx:id="offresButton" text="Offres de travail" onAction="#goToOffres" styleClass="sidebar-button"/>
                    <Button fx:id="candidatures" text="Mes Candidatures" onAction="#goToCandidatureHistory" styleClass="sidebar-button"/>
                    <Button fx:id="blogButton" text="Blog" onAction="#goToBlog" styleClass="sidebar-button"/>
                    <Button fx:id="btnCalendrier" text="ðŸ—“ï¸ Mon Calendrier" onAction="#openCalendrierView" styleClass="sidebar-button"/>
                    <Button fx:id="addMapButton"
                            text="ðŸ—ºï¸ Ma Parcelle"
                            onAction="#openLandDrawPage"
                            styleClass="sidebar-button"/>

                    <!-- âœ… New Messages Button -->
                    <Button fx:id="btnMessages" text="ðŸ’¬ Messages" onAction="#openMessagingPage" styleClass="sidebar-button"/>
                </VBox>
            </left>

            <!-- âœ… CONTENU CENTRAL -->
            <center>
                <StackPane fx:id="contentPane"/>
            </center>

        </BorderPane>
    </children>
</AnchorPane>
